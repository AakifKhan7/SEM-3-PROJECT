<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - TechScope</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/auth.css">
</head>

<body>

    <div class="main-container">
        <!-- Left Section -->
        <div class="branding-section">
            <div class="branding-overlay"></div>

            <div class="brand-content">
                <div class="brand-logo">TechScope</div>

                <div class="brand-bottom">
                    <div class="brand-tagline">
                        <h1>Saving your time,<br>Bringing you the best deals!!</h1>
                    </div>
                    <!-- <div class="brand-slider-dots">
                        <div class="dot active"></div>
                        <div class="dot"></div>
                        <div class="dot"></div>
                    </div> -->
                </div>
            </div>
        </div>

        <!-- Right Section -->
        <div class="form-section">
            <div class="form-header">
                <h2>Create an account</h2>
                <p>Already have an account? <a href="login.html">Log in</a></p>
            </div>

            <form id="signupForm">
                <div class="input-row">
                    <div class="mb-3 w-100">
                        <input type="text" class="custom-input form-control" id="firstName" placeholder="First name">
                    </div>
                    <div class="mb-3 w-100">
                        <input type="text" class="custom-input form-control" id="lastName" placeholder="Last name">
                    </div>
                </div>

                <div class="mb-3">
                    <input type="email" class="custom-input form-control" id="email" placeholder="Email" required>
                </div>

                <div class="mb-3">
                    <input type="tel" class="custom-input form-control" id="phone" pattern="(\+91)?[0-9]{10}" required
                        inputmode="numeric" placeholder="Mobile Number">
                </div>

                <div class="mb-3 password-container">
                    <input type="password" class="custom-input form-control" id="password"
                        placeholder="Enter your password" minlength="6" maxlength="14" required>
                    <i class="bi bi-eye password-toggle" id="togglePassword"></i>
                </div>

                <div class="mb-3 password-container">
                    <input type="password" class="custom-input form-control" id="confirmPassword"
                        placeholder="Confirm your password" required>
                    <i class="bi bi-eye password-toggle" id="toggleConfirmPassword"></i>
                </div>

                <div class="mb-3">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="terms" required>
                        <label class="form-check-label" for="terms">
                            I agree to the <a href="#" id="openTnC" style="color: #c0392b; font-weight: 600;">Terms
                                &amp; Conditions</a>
                        </label>
                    </div>
                </div>

                <div class="form-check mb-4"
                    style="border: 1px solid #ccc; border-radius: 8px; padding: 10px 14px; background: #f8f8f8;">
                    <input class="form-check-input" type="checkbox" id="isAdmin">
                    <label class="form-check-label fw-semibold" for="isAdmin" style="color: #333; font-size: 0.95rem;">
                        <i class="bi bi-shield-lock-fill me-1" style="color: #c0392b;"></i> Are you an Admin?
                    </label>
                </div>

                <div class="error-message" id="errorMessage"></div>
                <div class="success-message" id="successMessage"></div>

                <button type="submit" class="btn btn-primary-custom" id="submitBtn">Create account</button>


            </form>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const phone = document.getElementById('phone');

        phone.addEventListener("input", () => {
            const phoneRegex = /^(\+91)?[0-9]{10}$/;

            if (!phoneRegex.test(phone.value)) {
                phone.setCustomValidity("Please enter a valid 10-digit number (e.g., 9876543210 or +919876543210)");
            } else {
                // Clear the error message to allow form submission
                phone.setCustomValidity("");
            }
        });
        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('signupForm');
            const submitBtn = document.getElementById('submitBtn');
            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');
            const togglePassword = document.getElementById('togglePassword');
            const passwordInput = document.getElementById('password');
            const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
            const confirmPasswordInput = document.getElementById('confirmPassword');

            // Toggle Password Visibility
            function setupPasswordToggle(toggleBtn, inputField) {
                toggleBtn.addEventListener('click', function () {
                    const type = inputField.getAttribute('type') === 'password' ? 'text' : 'password';
                    inputField.setAttribute('type', type);
                    this.classList.toggle('bi-eye');
                    this.classList.toggle('bi-eye-slash');
                });
            }

            setupPasswordToggle(togglePassword, passwordInput);
            setupPasswordToggle(toggleConfirmPassword, confirmPasswordInput);

            // Form validation and submission
            form.addEventListener('submit', async function (e) {
                e.preventDefault();

                // Reset messages
                errorMessage.style.display = 'none';
                successMessage.style.display = 'none';
                errorMessage.textContent = '';

                // Get form values
                const email = document.getElementById('email').value.trim();
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                const firstName = document.getElementById('firstName').value.trim();
                const lastName = document.getElementById('lastName').value.trim();
                const phone = document.getElementById('phone').value.trim();
                const terms = document.getElementById('terms').checked;

                // Basic validation
                if (!terms) {
                    showError('You must agree to the Terms & Conditions');
                    return;
                }

                if (!email) {
                    showError('Please enter your email');
                    return;
                }

                if (password.length < 6) {
                    showError('Password must be at least 6 characters long');
                    return;
                }

                if (password !== confirmPassword) {
                    showError('Passwords do not match');
                    return;
                }

                // Show loading state
                const originalBtnText = submitBtn.textContent;
                submitBtn.disabled = true;
                submitBtn.textContent = 'Creating account...';

                // Prepare form data
                const formData = {
                    email: email,
                    password: password,
                    first_name: firstName || null,
                    last_name: lastName || null,
                    phone: phone || null
                };

                try {
                    // Call backend API
                    const response = await fetch('http://127.0.0.1:8000/api/auth/signup', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(formData)
                    });

                    const data = await response.json();

                    submitBtn.disabled = false;
                    submitBtn.textContent = originalBtnText;

                    if (response.ok) {
                        // Store token and user data
                        localStorage.setItem('authToken', data.access_token);
                        // localStorage.setItem('refreshToken', data.refresh_token); // Signup response might not have refresh token in some implementations, but let's check. 
                        // The auth.py /signup returns UserLoginResponse which HAS refresh_token (optional).
                        if (data.refresh_token) {
                            localStorage.setItem('refreshToken', data.refresh_token);
                        }

                        localStorage.setItem('user', JSON.stringify({
                            id: data.user_id,
                            email: data.email,
                            first_name: firstName || null,
                            last_name: lastName || null
                        }));

                        // Store username for dashboard display
                        const username = firstName || data.email.split('@')[0];
                        localStorage.setItem('username', username);

                        // Store admin status
                        const isAdmin = document.getElementById('isAdmin').checked;
                        localStorage.setItem('isAdmin', isAdmin ? 'true' : 'false');

                        // Show success message
                        showSuccess('Account created successfully! Redirecting...');

                        // Reset form
                        form.reset();

                        // Redirect based on admin status
                        setTimeout(function () {
                            window.location.href = isAdmin ? 'admin.html' : 'dashboard.html';
                        }, 2000);
                    } else {
                        // Show error message from backend
                        showError(data.detail || 'Registration failed. Please try again.');
                    }
                } catch (error) {
                    console.error('Signup error:', error);
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalBtnText;

                    // Fallback to demo mode if backend is not available (copied from original)
                    // If backend is down, we might want to let them in for demo?
                    // But original code had a demo fallback. I'll keep it for robustness? 
                    // No, cleaner to just show error. But I'll leave a small demo fallback comment or logic if desired.
                    // I will stick to showing error to be proper.

                    // Actually, for user experience in dev environment, maybe good to keep demo fallback if backend fails.
                    // I will replicate the original fallback logic but simplified.
                    if (formData.email && formData.password.length >= 6) {
                        // Demo mode
                        console.warn("Backend unavailable, using demo mode");
                        localStorage.setItem('authToken', 'demo-token-' + Date.now());
                        localStorage.setItem('user', JSON.stringify({
                            email: formData.email,
                            first_name: formData.first_name,
                            last_name: formData.last_name
                        }));
                        const username = formData.first_name || formData.email.split('@')[0];
                        localStorage.setItem('username', username);
                        showSuccess('Account created successfully (Demo)! Redirecting...');
                        setTimeout(function () {
                            window.location.href = 'dashboard.html';
                        }, 2000);
                    } else {
                        showError('Network error. Please try again later.');
                    }
                }
            });

            // Helper functions
            function showError(message) {
                errorMessage.textContent = message;
                errorMessage.style.display = 'block';
            }

            function showSuccess(message) {
                successMessage.textContent = message;
                successMessage.style.display = 'block';
            }


        });
    </script>
    <!-- ── Terms & Conditions Modal ── -->
    <div id="tncModal"
        style="display:none; position:fixed; inset:0; z-index:9999; background:rgba(0,0,0,0.55); backdrop-filter:blur(4px); overflow-y:auto; padding:2rem 1rem;">
        <div
            style="max-width:680px; margin:auto; background:#fff; border-radius:16px; box-shadow:0 20px 60px rgba(0,0,0,0.25); overflow:hidden;">

            <!-- Modal Header -->
            <div
                style="background:#000; color:#fff; padding:1.25rem 1.75rem; display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <h2 style="margin:0; font-size:1.2rem; font-weight:700;"><i class="bi bi-file-text-fill me-2"
                            style="color:#e74c3c;"></i>Terms &amp; Conditions</h2>
                    <p style="margin:0; font-size:0.75rem; color:#aaa; margin-top:3px;">TechScope &mdash; Effective 20
                        Feb 2026</p>
                </div>
                <button id="closeTnC"
                    style="background:none; border:none; color:#fff; font-size:1.4rem; cursor:pointer; line-height:1;"
                    aria-label="Close">&times;</button>
            </div>

            <!-- Scrollable Body -->
            <div
                style="padding:1.75rem; max-height:65vh; overflow-y:auto; font-size:0.88rem; color:#333; line-height:1.7;">

                <p>Welcome to <strong>TechScope</strong>. By creating an account or using our platform, you agree to the
                    following Terms &amp; Conditions. Please read them carefully.</p>

                <h3 style="font-size:0.95rem; font-weight:700; margin-top:1.25rem; color:#000;">1. About TechScope</h3>
                <p>TechScope is a price comparison and deal aggregation platform designed to help consumers compare
                    prices of tech products — including smartphones, laptops, headphones, and other electronics — across
                    multiple online retailers. We do not sell products directly.</p>

                <h3 style="font-size:0.95rem; font-weight:700; margin-top:1.25rem; color:#000;">2. Eligibility</h3>
                <p>You must be at least <strong>13 years of age</strong> to register and use TechScope. By signing up,
                    you confirm that all information you provide is accurate and up-to-date.</p>

                <h3 style="font-size:0.95rem; font-weight:700; margin-top:1.25rem; color:#000;">3. Account
                    Responsibilities</h3>
                <ul style="padding-left:1.25rem;">
                    <li>You are responsible for maintaining the confidentiality of your login credentials.</li>
                    <li>You agree not to share your account with any other person.</li>
                    <li>You must notify us immediately if you suspect any unauthorized access to your account.</li>
                    <li>TechScope is not liable for any loss resulting from unauthorized use of your account.</li>
                </ul>

                <h3 style="font-size:0.95rem; font-weight:700; margin-top:1.25rem; color:#000;">4. Use of the Platform
                </h3>
                <p>You agree to use TechScope only for lawful purposes. You must not:</p>
                <ul style="padding-left:1.25rem;">
                    <li>Attempt to scrape, harvest, or mirror our data without written permission.</li>
                    <li>Use automated bots or scripts to interact with the platform.</li>
                    <li>Attempt to compromise the security or integrity of our systems.</li>
                    <li>Post or transmit any harmful, misleading, or abusive content.</li>
                </ul>

                <h3 style="font-size:0.95rem; font-weight:700; margin-top:1.25rem; color:#000;">5. Price &amp; Product
                    Data</h3>
                <p>Product prices and availability displayed on TechScope are sourced from third-party retailers and may
                    change without notice. We strive for accuracy but do not guarantee that prices are current or
                    error-free. Always verify the final price on the retailer's website before purchasing.</p>

                <h3 style="font-size:0.95rem; font-weight:700; margin-top:1.25rem; color:#000;">6. Price Alerts</h3>
                <p>The price alert feature notifies you when a product's price drops below your set threshold. Alert
                    delivery depends on system availability and third-party data refresh rates. TechScope is not liable
                    for missed alerts or price discrepancies.</p>

                <h3 style="font-size:0.95rem; font-weight:700; margin-top:1.25rem; color:#000;">7. Intellectual Property
                </h3>
                <p>All content, branding, logos, and code associated with TechScope are the intellectual property of
                    TechScope and its contributors. You may not reproduce, modify, or distribute any part of the
                    platform without explicit written permission.</p>

                <h3 style="font-size:0.95rem; font-weight:700; margin-top:1.25rem; color:#000;">8. Privacy Policy</h3>
                <p>We collect personal data (name, email, and usage data) solely to provide and improve our services. We
                    do not sell your personal data to third parties. Data is stored securely and handled in accordance
                    with applicable data protection laws.</p>

                <h3 style="font-size:0.95rem; font-weight:700; margin-top:1.25rem; color:#000;">9. Limitation of
                    Liability</h3>
                <p>TechScope is provided "as is" without warranties of any kind. We are not liable for any direct,
                    indirect, incidental, or consequential damages arising from your use of the platform, including
                    losses resulting from purchasing decisions made based on our data.</p>

                <h3 style="font-size:0.95rem; font-weight:700; margin-top:1.25rem; color:#000;">10. Modifications to
                    Terms</h3>
                <p>We reserve the right to update these Terms &amp; Conditions at any time. Continued use of TechScope
                    after changes are posted constitutes acceptance of the revised terms. We will notify registered
                    users of significant changes via email.</p>

                <h3 style="font-size:0.95rem; font-weight:700; margin-top:1.25rem; color:#000;">11. Termination</h3>
                <p>TechScope reserves the right to suspend or terminate your account at any time if you violate these
                    terms, without prior notice or liability.</p>

                <h3 style="font-size:0.95rem; font-weight:700; margin-top:1.25rem; color:#000;">12. Contact Us</h3>
                <p>For questions or concerns regarding these Terms &amp; Conditions, please contact us at:<br>
                    <strong><i class="bi bi-envelope me-1"></i>kothariparthiv26@gmail.com</strong><br>
                    <strong><i class="bi bi-phone me-1"></i>+91 6351834679</strong>
                </p>

                <p style="margin-top:1.5rem; font-size:0.8rem; color:#888;">Last updated: 20 February 2026
                    &nbsp;&bull;&nbsp; TechScope &copy; 2026</p>
            </div>

            <!-- Modal Footer -->
            <div
                style="padding:1rem 1.75rem; border-top:1px solid #eee; display:flex; justify-content:flex-end; gap:0.75rem;">
                <button id="declineTnC"
                    style="padding:9px 20px; border:1px solid #ccc; border-radius:8px; background:#f5f5f5; font-size:0.85rem; cursor:pointer; font-weight:600; color:#555;">Decline</button>
                <button id="acceptTnC"
                    style="padding:9px 20px; border:none; border-radius:8px; background:#000; color:#fff; font-size:0.85rem; cursor:pointer; font-weight:600;">I
                    Agree</button>
            </div>
        </div>
    </div>

    <script>
        // T&C Modal logic
        const tnc = document.getElementById('tncModal');
        document.getElementById('openTnC').addEventListener('click', function (e) {
            e.preventDefault();
            tnc.style.display = 'block';
            document.body.style.overflow = 'hidden';
        });
        function closeTnC() {
            tnc.style.display = 'none';
            document.body.style.overflow = '';
        }
        document.getElementById('closeTnC').addEventListener('click', closeTnC);
        document.getElementById('declineTnC').addEventListener('click', function () {
            document.getElementById('terms').checked = false;
            closeTnC();
        });
        document.getElementById('acceptTnC').addEventListener('click', function () {
            document.getElementById('terms').checked = true;
            closeTnC();
        });
        // Close on backdrop click
        tnc.addEventListener('click', function (e) {
            if (e.target === tnc) closeTnC();
        });
    </script>

</body>

</html>